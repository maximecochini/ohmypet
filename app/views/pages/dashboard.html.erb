<% @page_title = "Dashboard" %>

<div class="container omp_mt-section blob-relative">
  <h1 class="text-center">Your Dashboard</h1>
  <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" class="blob blob-title-center">
    <path fill="#BAE6FF" d="M44.4,-53.9C59.3,-50.3,74.3,-39.7,79,-25.6C83.8,-11.5,78.2,6.1,69.1,18.8C60,31.6,47.2,39.5,35.1,46.9C23,54.4,11.5,61.3,-0.1,61.4C-11.7,61.6,-23.3,54.9,-38,48.3C-52.7,41.7,-70.4,35.2,-79.5,22.3C-88.6,9.4,-88.9,-9.8,-80.5,-23.2C-72.1,-36.7,-54.9,-44.3,-40,-47.8C-25.1,-51.4,-12.6,-50.9,1.1,-52.4C14.8,-53.9,29.6,-57.5,44.4,-53.9Z" transform="translate(55 55)" />
  </svg>
</div>

<div class="container omp_mt-section">
  <div class="container omp_mt-section blob-relative">
    <h2>Loves you will sit for</h2>
  </div>
  <div class="omp_grid-2-3 omp_z-index-1 omp_p-relative">
    <% @sittings.each do |sitting| %>
      <div class="omp_card omp_card-2-3 d-flex flex-row align-items-center justify-content-between">

        <img src="<%= cl_image_path sitting.pet.photo.key %>" class="omp_card-avatar border" alt="">

        <div class="col-3 px-4 omp_d-none-mob">
          <p class="omp_pet-name omp_headers-font mb-1"><%= sitting.pet.name.capitalize %></p>
          <p class="omp_pet-info mb-0"><i class="fas fa-baby"></i> <strong><%= sitting.pet.age %></strong> yr. old</p>
        </div>

        <div class="nav-item omp_vl"></div>

        <div class="flex-grow-1 px-4 omp_d-none-mob">
          <div class="d-flex justify-content-between">
            <span class="omp_pet-badge badge badge-primary"><strong><%= sitting.pet.species.capitalize %></strong></span>
            <% if sitting.pet.reviews.empty? == false %><strong><i class="fas fa-heart"></i> <%= Review.where(pet_id: sitting.pet).average(:rating).round(1) %></strong><% end %>
          </div>
          <p class="omp_announce-title mb-0 mt-1"><%= sitting.pet.description[0..30].capitalize %></p>
        </div>

        <div class="nav-item omp_vl"></div>

        <div class="px-2">
          <%= link_to pet_path(sitting.pet), class: "omp_light-peach omp_no-deco" do %>
            <i class="omp_card-large-i fas fa-paw"></i>
          <% end %>
        </div>
      </div>

      <div class="omp_card omp_card-1-3 d-flex flex-row align-items-center">

        <img src="<%= cl_image_path sitting.pet.user.photo.key %>" class="omp_card-avatar border" alt="">

        <div class="flex-grow-1 px-4">
          <div class="d-flex justify-content-between mb-1">
            <span class="omp_owner-name omp_headers-font"><%= sitting.pet.user.first_name.capitalize %> <%= sitting.pet.user.last_name.capitalize %></span>
            <span class="omp_pet-likes"><i class="fas fa-heart"></i> 4.8</span>
          </div>
          <span class="omp_sitting_dates omp_headers-font"><i class="fas fa-calendar"></i> <%= sitting.start_date.strftime('%a %d %b') %> - <%= sitting.end_date.strftime('%a %d %b') %></span>
        </div>

        <div class="nav-item omp_vl"></div>

        <div class="px-2">
          <%= link_to sitting_path(sitting), class: "omp_light-peach omp_no-deco" do %>
            <i class="omp_card-large-i fas fa-list-ul"></i>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<div class="container omp_mt-section">
  <div class="container omp_mt-section blob-relative">
    <h2>Manage your pets</h2>
    <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" class="blob blob-title-left">
      <path fill="#FFD6E8" d="M46.4,-50.4C53,-39.7,46.5,-19.9,43.9,-2.6C41.3,14.6,42.6,29.3,35.9,40.8C29.3,52.3,14.6,60.7,-0.2,61C-15.1,61.2,-30.1,53.2,-45.6,41.7C-61,30.1,-76.8,15.1,-73.1,3.7C-69.4,-7.6,-46.2,-15.3,-30.7,-26C-15.3,-36.7,-7.6,-50.4,6.1,-56.5C19.9,-62.6,39.7,-61.1,46.4,-50.4Z" transform="translate(55 55)" />
    </svg>
  </div>
  <div class="omp_grid-2-3 omp_z-index-1 omp_p-relative">
    <% @pets.order(:name).each do |pet| %>
      <div class="omp_card omp_card-2-3 d-flex flex-row align-items-center justify-content-between">

        <img src="<%= cl_image_path pet.photo.key %>" class="omp_card-avatar border" alt="">

        <div class="col-3 px-4 omp_d-none-mob">
          <p class="omp_pet-name omp_headers-font mb-1"><%= pet.name.capitalize %></p>
          <p class="omp_pet-info mb-0"><i class="fas fa-baby"></i> <strong><%= pet.age %></strong> yr. old</p>
        </div>

        <div class="nav-item omp_vl"></div>

        <div class="flex-grow-1 px-4 omp_d-none-mob">
          <div class="d-flex justify-content-between">
            <span class="omp_pet-badge badge badge-primary"><strong><%= pet.species.capitalize %></strong></span>
            <% if pet.reviews.empty? == false %><strong><i class="fas fa-heart"></i> <%= Review.where(pet_id: pet).average(:rating).round(1) %></strong><% end %>
          </div>
          <p class="omp_announce-title mb-0 mt-1"><%= pet.description[0..30].capitalize %></p>
        </div>

        <div class="nav-item omp_vl"></div>

        <div class="px-2">
          <%= link_to pet_path(pet), class: "omp_light-peach omp_no-deco" do %>
            <i class="omp_card-large-i fas fa-paw"></i>
          <% end %>
        </div>
      </div>
      
      <% sitting = pet.sittings[0] %>
      <% if pet.sittings.empty? %>
        <div class="d-flex omp_card omp_card-1-3 omp_card-empty text-center align-items-center justify-content-center omp_headers-font">
          <div>Don't worry, we'll find someone amazing ;-)</div>
        </div>

        <% else %>

        <div class="omp_card omp_card-1-3 d-flex flex-row align-items-center justify-content-between">
          <img src="<%= cl_image_path sitting.user.photo.key %>" class="omp_card-avatar border" alt="">
          
          <div class="flex-grow-1 px-4">
            <div class="d-flex justify-content-between mb-1">
              <span class="omp_owner-name omp_headers-font"><%= sitting.user.first_name.capitalize %> <%= sitting.user.last_name.capitalize %></span>
              <span class="omp_pet-likes"><i class="fas fa-heart"></i> 4.8</span>
            </div>
            <span class="omp_sitting_dates omp_headers-font"><i class="fas fa-calendar"></i> <%= sitting.start_date.strftime('%a %d %b') %> - <%= sitting.end_date.strftime('%a %d %b') %></span>
          </div>

          <div class="nav-item omp_vl"></div>

          <div class="px-2">
            <%= link_to sitting_path(sitting), class: "omp_light-peach omp_no-deco", method: :delete, data: { confirm: "Are you sure?" } do %>
              <i class="omp_card-large-i fas fa-times"></i>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
  <div class="omp_grid-2-3 omp_z-index-1 omp_p-relative">
    <%= link_to new_pet_path, class: "d-flex omp_card omp_card-2-3 omp_card-empty text-center align-items-center justify-content-center omp_headers-font" do %>
        <div><i class="omp_card-large-i fas fa-plus"></i> Add a new pet</div>
    <% end %>
  </div>
</div>
